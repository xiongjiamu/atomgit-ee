<template>
  <div class="space-y-6 animate-in fade-in slide-in-from-bottom-2 duration-500">
    <!-- Header Area -->
    <!-- View Selector & Header -->
    <div class="flex items-center justify-between mb-4">
      <ViewSelector :selected-view="selectedView" @change="$emit('view-change', $event)" />
      <div class="flex items-center gap-2 text-slate-400 text-xs font-bold uppercase tracking-widest bg-slate-50 dark:bg-slate-800/40 px-3 py-1.5 rounded-lg border border-slate-100 dark:border-slate-800/60 shadow-sm transition-all hover:bg-slate-100 dark:hover:bg-slate-800/60">
        <span class="material-icons-round text-primary text-sm">insights</span>
        <span class="font-black">äº¤ä»˜æ•ˆèƒ½æ´å¯Ÿ</span>
      </div>
    </div>

    <!-- Alert Banners -->
    <div class="space-y-3">
      <div class="bg-amber-50/50 dark:bg-amber-900/10 border border-amber-100 dark:border-amber-900/20 rounded-xl p-4 flex items-start">
        <span class="material-icons-round text-amber-500 text-lg mt-0.5 mr-3">info</span>
        <div class="flex-1 text-sm text-amber-800 dark:text-amber-200">
          <span class="font-bold mr-1">èµ„æºé¢„è­¦:</span> æ‚¨ä¼ä¸šå½“å‰çš„å­˜å‚¨ç©ºé—´å·²ä½¿ç”¨ 856GB (85%), æ¥è¿‘åŒ…å¹´å¥—é¤ä¸Šé™ï¼Œè¯·å…³æ³¨èµ„æºæ¶ˆè€—æˆ–åŠæ—¶æ‰©å®¹
        </div>
        <button class="text-amber-400 hover:text-amber-600 transition-colors">
          <span class="material-icons-round text-lg">close</span>
        </button>
      </div>
      <div class="bg-blue-50/50 dark:bg-blue-900/10 border border-blue-100 dark:border-blue-900/20 rounded-xl p-4 flex items-start">
        <span class="material-icons-round text-blue-600 dark:text-blue-400 text-lg mt-0.5 mr-3">campaign</span>
        <div class="flex-1 text-sm text-blue-800 dark:text-blue-200">
          <span class="font-bold mr-1">ä¼ä¸šå…¬å‘Š:</span> AtomGit å°†äºæœ¬å‘¨äº” 22:00 è¿›è¡Œç‰ˆæœ¬å‡çº§ï¼Œå±Šæ—¶ CI/CD æœåŠ¡å¯èƒ½ä¼šæœ‰çŸ­æ—¶é—ªæ–­ï¼Œè¯·çŸ¥æ‚‰
        </div>
        <button class="text-blue-400 hover:text-blue-600 transition-colors">
          <span class="material-icons-round text-lg">close</span>
        </button>
      </div>
    </div>

    <!-- Top Grid: SLA Score & Success Trend -->
    <div class="grid grid-cols-1 lg:grid-cols-12 gap-6">
      <!-- SLA Score Card -->
      <div class="lg:col-span-5 bg-gradient-to-br from-indigo-600 to-blue-700 dark:from-indigo-900 dark:to-blue-900 rounded-xl p-10 text-white relative overflow-hidden shadow-2xl flex flex-col justify-between min-h-[380px] group transition-all hover:scale-[1.01]">
        <div class="absolute -right-20 -top-20 w-80 h-80 bg-white/10 blur-[100px] rounded-full group-hover:bg-white/20 transition-all"></div>
        <div class="absolute bottom-10 right-10 opacity-10 scale-[5] group-hover:scale-[6] transition-transform duration-1000">
          <span class="material-icons-round text-white text-[120px]">verified</span>
        </div>
        
        <div class="relative z-10">
          <h2 class="text-xs font-black uppercase tracking-[0.3em] text-white/90 mb-6">SLA äº¤ä»˜å¥åº·è¯„åˆ†</h2>
          <div class="flex items-baseline gap-2 mb-4">
            <span class="text-8xl font-black tracking-tighter">94</span>
            <span class="text-xl font-bold text-white/60">/ 100</span>
          </div>
          <div class="inline-flex items-center gap-2 bg-white/10 backdrop-blur-md px-4 py-2 rounded-xl border border-white/10">
            <div class="w-2 h-2 rounded-full bg-emerald-400 animate-pulse"></div>
            <span class="text-xs font-black uppercase tracking-widest">ä¼˜ç§€ (Exceeds Goal)</span>
          </div>
        </div>

        <div class="relative z-10 mt-auto">
          <p class="text-[10px] font-bold text-white/80 uppercase tracking-widest leading-relaxed">
            è¯„åˆ†åŸºäºæˆåŠŸç‡ (Success Rate)ã€å¹³å‡æ’é˜Ÿæ—¶é•¿ (Wait Time) åŠ <br/> æ•…éšœæ¢å¤æ—¶é•¿ (MTTR) ç»¼åˆè®¡ç®—ã€‚
          </p>
        </div>
      </div>

      <!-- Success Rate Chart Placeholder Style -->
      <div class="lg:col-span-7 bg-white dark:bg-surface-dark border border-slate-200 dark:border-slate-800 rounded-xl p-10 shadow-sm flex flex-col">
        <div class="flex justify-between items-center mb-10">
          <div>
            <h3 class="text-lg font-black text-slate-900 dark:text-white tracking-tight">æ„å»ºæˆåŠŸç‡è¶‹åŠ¿</h3>
            <p class="text-xs font-bold text-slate-400 uppercase tracking-widest mt-1">Past 14 Days Analytics</p>
          </div>
          <div class="flex items-center gap-6">
            <div class="flex items-center gap-2">
              <div class="w-2.5 h-2.5 rounded-full bg-primary/40"></div>
              <span class="text-[10px] font-black text-slate-500 uppercase tracking-widest">Success</span>
            </div>
            <div class="flex items-center gap-2">
              <div class="w-2.5 h-2.5 rounded-full bg-rose-400"></div>
              <span class="text-[10px] font-black text-slate-500 uppercase tracking-widest">Failure</span>
            </div>
          </div>
        </div>
        
        <div class="flex-1 flex items-end justify-between gap-3 h-48 px-2 relative mb-6">
          <div 
            v-for="(bar, index) in trendBars" 
            :key="index"
            :class="['flex-1 rounded-xl transition-all duration-700 hover:scale-105 cursor-pointer shadow-sm', bar.color]"
            :style="{ height: bar.height + '%' }"
          ></div>
          <!-- Grid Lines (Faded) -->
          <div class="absolute inset-x-0 top-0 h-px bg-slate-100 dark:bg-slate-800/50"></div>
          <div class="absolute inset-x-0 top-1/2 h-px bg-slate-100 dark:bg-slate-800/50 border-dashed border-t"></div>
        </div>
        
        <div class="flex justify-between text-[10px] font-black text-slate-400 uppercase tracking-widest px-2">
          <span>01/10</span>
          <span>01/17</span>
          <span class="text-primary">Today</span>
        </div>
      </div>
    </div>

    <!-- Bottom Grid: Efficiency & Error Breakdown -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
      <!-- Efficiency Indicators -->
      <div class="bg-white dark:bg-surface-dark border border-slate-200 dark:border-slate-800 rounded-xl p-10 shadow-sm">
        <div class="flex items-center gap-3 mb-10">
          <div class="w-10 h-10 rounded-xl bg-primary/10 flex items-center justify-center">
            <span class="material-icons-round text-primary">schedule</span>
          </div>
          <h3 class="text-lg font-black text-slate-900 dark:text-white tracking-tight">SLA äº¤ä»˜æ•ˆç‡æŒ‡æ ‡</h3>
        </div>
        
        <div class="space-y-10">
          <div v-for="metric in efficiencyMetrics" :key="metric.label">
            <div class="flex justify-between items-end mb-3">
              <div class="flex flex-col">
                <span class="text-sm font-bold text-slate-700 dark:text-slate-300">{{ metric.label }}</span>
                <span class="text-[10px] font-black text-slate-400 uppercase tracking-widest mt-1">{{ metric.sublabel }}</span>
              </div>
              <div class="flex items-baseline gap-1">
                <span :class="['text-3xl font-black tracking-tight', metric.valueColor]">{{ metric.value }}</span>
                <span class="text-xs font-bold text-slate-400">{{ metric.unit }}</span>
              </div>
            </div>
            <div class="w-full bg-slate-100 dark:bg-slate-800 rounded-full h-2 overflow-hidden relative">
              <div 
                :class="['h-full rounded-full transition-all duration-1000', metric.progressColor]" 
                :style="{ width: metric.percent + '%' }"
              ></div>
            </div>
            <div class="flex items-center gap-2 mt-3">
              <span class="text-[10px] font-black text-slate-400 uppercase tracking-widest">Goal: {{ metric.goal }}</span>
              <div class="w-1 h-1 rounded-full bg-slate-200"></div>
              <span :class="['text-[10px] font-black uppercase tracking-widest', metric.statusColor]">{{ metric.status }}</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Error Breakdown -->
      <div class="bg-white dark:bg-surface-dark border border-slate-200 dark:border-slate-800 rounded-xl p-10 shadow-sm">
        <div class="flex items-center gap-3 mb-10">
          <div class="w-10 h-10 rounded-xl bg-rose-100 dark:bg-rose-900/30 flex items-center justify-center">
            <span class="material-icons-round text-rose-500">warning_amber</span>
          </div>
          <h3 class="text-lg font-black text-slate-900 dark:text-white tracking-tight">å¤±è´¥åŸå› åˆ†å¸ƒ</h3>
        </div>

        <div class="space-y-8">
          <div v-for="error in errors" :key="error.name" class="flex items-center gap-6">
            <div class="w-24 shrink-0">
              <span class="text-xs font-black text-slate-600 dark:text-slate-400 uppercase tracking-tighter">{{ error.name }}</span>
            </div>
            <div class="flex-1">
              <div class="w-full bg-slate-100 dark:bg-slate-800 rounded-full h-3 overflow-hidden relative group">
                <div 
                  :class="['h-full rounded-full transition-all duration-1000', error.color]" 
                  :style="{ width: error.percent + '%' }"
                ></div>
              </div>
            </div>
            <div class="w-12 text-right">
              <span class="text-sm font-black text-slate-900 dark:text-white">{{ error.percent }}%</span>
            </div>
          </div>
        </div>
        
        <div class="mt-12 p-6 bg-slate-50 dark:bg-slate-800/50 rounded-3xl border border-dashed border-slate-200 dark:border-slate-700">
          <p class="text-xs font-bold text-slate-500 leading-relaxed">
            <span class="text-primary mr-1">ğŸ’¡ Insight:</span> 
            æœ¬å‘¨ã€Œç¯å¢ƒåŸºç¡€è®¾æ–½ã€é”™è¯¯ç‡ä¸Šå‡ 12%ï¼Œä¸»è¦é›†ä¸­åœ¨è‡ªå»º Runner çš„ Docker é•œåƒæ‹‰å–è¶…æ—¶ï¼Œå»ºè®®ä¼˜åŒ–å›½å†…é•œåƒæºé…ç½®ã€‚
          </p>
        </div>
      </div>
    </div>
  </div>
</template>

<script>
import ViewSelector from './ViewSelector.vue'

export default {
  name: 'QualityReport',
  components: {
    ViewSelector
  },
  props: {
    selectedView: {
      type: Object,
      required: true
    }
  },
  data() {
    return {
      trendBars: [
        { height: 65, color: 'bg-primary/20' },
        { height: 75, color: 'bg-primary/30' },
        { height: 15, color: 'bg-rose-400 shadow-lg shadow-rose-200 dark:shadow-rose-900/20' },
        { height: 80, color: 'bg-primary/40' },
        { height: 70, color: 'bg-primary/30' },
        { height: 85, color: 'bg-primary/50' },
        { height: 90, color: 'bg-primary' },
        { height: 72, color: 'bg-primary/40' },
        { height: 68, color: 'bg-primary/30' },
        { height: 78, color: 'bg-primary/40' },
        { height: 82, color: 'bg-primary/45' },
        { height: 60, color: 'bg-primary/25' },
        { height: 92, color: 'bg-primary' },
        { height: 88, color: 'bg-primary/10' }
      ],
      efficiencyMetrics: [
        { 
          label: 'å¹³å‡æ’é˜Ÿè€—æ—¶', 
          sublabel: 'Waiting for Runner', 
          value: '12', 
          unit: 's', 
          percent: 20, 
          goal: '< 1m', 
          status: 'ç¬¦åˆé¢„æœŸ', 
          statusColor: 'text-emerald-500', 
          valueColor: 'text-slate-900 dark:text-white', 
          progressColor: 'bg-primary' 
        },
        { 
          label: 'å¹³å‡æ•…éšœæ¢å¤æ—¶é•¿', 
          sublabel: 'MTTR', 
          value: '2.4', 
          unit: 'h', 
          percent: 65, 
          goal: '< 1h', 
          status: 'éœ€å…³æ³¨', 
          statusColor: 'text-amber-500', 
          valueColor: 'text-amber-500', 
          progressColor: 'bg-amber-500' 
        }
      ],
      errors: [
        { name: 'ä»£ç è„šæœ¬é”™è¯¯', percent: 65, color: 'bg-rose-500' },
        { name: 'ç¯å¢ƒåŸºç¡€è®¾æ–½', percent: 25, color: 'bg-amber-500' },
        { name: 'ç¬¬ä¸‰æ–¹ API', percent: 10, color: 'bg-slate-400' }
      ]
    }
  }
}
</script>
